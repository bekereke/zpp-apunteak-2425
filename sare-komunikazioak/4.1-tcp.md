---
hidden: true
---

# 4.1 TCP

Transmisioaren Kontrol Protokoloa, TCP bezala ezagutzen dena, <mark style="background-color:purple;">konexioetara bideratutako protokoloa</mark> da. Bermea dira konexioaren mutur batetik bidalitako datuak beste muturrera iristeko, eta, egin ere, bidalitako ordena berean. Bestela, akatsaren berri emango dute. TCP da garraio-geruzako protokolo nagusietakoa TCP/IP ereduan, eta datu-komunikazio fidagarria eta ordenatua behar duten Interneteko aplikazio askotan erabilia.&#x20;

Hona hemen datuak entregatzearen eta ordenan egitearen bermerako <mark style="background-color:purple;">oinarri teorikoa</mark>:

1. **Konexioei bideratua:** TCPk konexio bat ezartzen du datuen transmisioa hasi aurretik. Horretarako, hiru bideko eskuak estutu behar dira konexioa behar bezala konfiguratzeko.

<figure><img src="../.gitbook/assets/Pantaila-argazkia 2024-10-29 095130.png" alt="" width="360"><figcaption><p> Ikusi daitezke hiru bideko TCP esku-emateak. <br>Hau da TCP protokoloan konexioa ezartzeko erabiltzen den prozesua.</p></figcaption></figure>

2. **Entrega bermea**: TCPk bermatzen du bidalitako datu guztiak behar bezala jasotzen direla hartzailearen muturrean. Sekuentziako zenbakiak erabiltzen ditu datu-segmentu bakoitza arakatzeko, eta hartzailearen ACK errekonozimendua jasotzea espero du. ACK bat jasotzen ez bada, TCPk datuak igortzen ditu entregatzea bermatzeko.
3. **Entregatzeko agindua**: TCPk datuak bidalitako ordena berean entregatzen ditu. Datuen segmentu bakoitza sekuentzia zenbaki batekin markatuta dago, eta horrek aukera ematen dio hartzaileari behar izanez gero berriro ordenatzeko.
4. **Erroreen detekzioa eta zuzenketa**: TCPk erroreak detektatzen ditu transmititutako datuetan egiaztapeneko batuketa mekanismo baten bidez. Erroreren bat atzematen bada, datu-segmentuaren igorpena eskatzen du.
5. **Fluxuaren kontrola**: TCPk fluxua kontrolatzeko mekanismoak ditu, sarearen kongestioa prebenitzeko eta hartzaileak datuak jasotzeko tasa maneiatu ahal izatea ziurtatzeko.

Konexioak ezartzera bideratutako trasmisio protokoloek, TCPk hainbaten artean, ondoko eragiketak burutzen dituzte:

1. **Konexio-ezarpena**: Urrats hau komunikazioen hasieran egin behar da komunikazio-kanal bat sortzeko. Irekita egongo da beste aldetik itxi arte.
2. **Mezuen transmisioa**: Urrats hau nahi adina aldiz egin daiteke, betiere komunikazioa posible bada (protokolo pilaren maila baxuenek funtzionatzen jarraitzen dute). Komunikazio-kanala mezu bakoitza transmititzeko berrerabiltzen da, eta pakete bakoitza ordena egokian iristen dela bermatzen da.
3. **Konexioaren amaiera**: Hau da azken pausoa eta komunikazioak eten nahi direnean bakarrik egiten da.

{% hint style="info" %}
Kanala itxi ondoren, komunikazioa berriro hasi nahi izanez gero, lehenengo urratsa errepikatu beharko da.
{% endhint %}

Laburbilduz: TCP oso protokolo fidagarria eta sendoa da. Datuak ordenan jasotzea bermatzen du eta transmisio akatsak detektatu eta zuzentzen ditu. Hori egokia da datuen osotasuna eta sekuentziazioa funtsezkoak diren aplikazioetarako. Hala nola, fitxategien transferentziarako; posta elektronikorako; web-nabigaziorako; eta, Interneteko beste aplikazio askotarako.

## **`Socket` eta `ServerSocket` klaseak** <a href="#socket-and-serversocket" id="socket-and-serversocket"></a>

Javan, TCP (Transmisioa Kontrolatzeko Protokoloa) bidez komunikatzeko eta sareak programatzeko `java.net` paketea dago eskuragarri.&#x20;

`Socket` klasea da abia√πntua bi makinen arteko TCP komunikaziorako. Java `Socket` klasea sarrerako konexioak entzuteko, zein, bezero bat konektatzen denean Socket instantzia berriak sortzeko erabiltzen da. Entzuten aktiboki egoten da.&#x20;

* Bezeroaren partean TCP Socketa sortzeko metodo eraikitzailea:

```java
Socket clientSocket = new Socket(serverAddress, port);
```

* Sarrerako konexioak onartzeko zerbitzariko TCP Socketa sortzeko metodo eraikitzailea:

```java
ServerSocket serverSocket = new ServerSocket(port);
Socket clientSocket = serverSocket.accept(); // Konektatu nahi duten bezeroen zain egoteko
```

## Sarrera eta irteera fluxuen kontrola (bis)

`Socket` instantzia bat dagoelarik, horren sarrerako eta irteerako fluxuak lortzen dira, eta, horrela, datuak bidali eta jaso. Datuak irakurtzeko eta idazteko, `InputStream` eta `OutputStream` klaseak daude erabilgarri, hurrenez hurren.

### Bezeroan

```java
InputStream in = clientSocket.getInputStream();
OutputStream out = clientSocket.getOutputStream();
```

### Zerbitzarian

Konexio eskaera onartu ostean:

```java
InputStream in = clientSocket.getInputStream();
OutputStream out = clientSocket.getOutputStream();
```

### Datuak kapsulatzea irakurketentzako eta idazketentzako

Sarrerako eta irteerako fluxuak erabili daitezke datuak (adibidez, byteak) bidaltzeko eta jasotzeko. Testu-datuekin, zenbakiekin edo objektuekin lan egiteko, fluxu horiek objektuetan bildu behar dira:

#### `BufferedReader` eta `BufferedWriter`

Testu erako datuak irakurtzeko eta idazteko:

* `InputStream` irakurtzeko erabilera adibidea `BufferedReader` bidez:

```javascript
InputStream inputStream = socket.getInputStream();
BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream));
String line;
while ((line = reader.readLine()) != null){//null konexioa itxita dagoenean
    //"ACK" itzultzen baldin badu edo aukeratu beste esaldia{
        // PROZESATU ESALDIAN DATORRENA}
}
```

* `OutputStream` irteerako fluxuan idazteko erabilera adibidea `BufferedWriter` bidez:

```java
OutputStream outputStream = socket.getOutputStream();
BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(outputStream));
writer.write("Kaixo, zerbitzari!");
writer.newLine(); // newline idatzi mezuaren amaiera adierazteko
writer.flush(); // bufferra hustea bidalketa gauzatzeko
```

`DataInputStream` eta `DataOutputStream`&#x20;

Oinarrizko erako datuak irakurtzeko eta idazteko:

* `InputStream`eko zenbaki bat irakurtzeko `DataInputStream` bidez:

```java
InputStream inputStream = socket.getInputStream();
DataInputStream dataInput = new DataInputStream(inputStream);
int intValue = dataInput.readInt();
```

* `OutputStream` irteera fluxuko zenbaki bat idazteko `DataOutputStream` bidez:

```java
OutputStream outputStream = socket.getOutputStream();
DataOutputStream dataOutput = new DataOutputStream(outputStream);
dataOutput.writeInt(42);
dataOutput.flush();
```

